<div class="w-full max-w-[1600px] mx-auto flex flex-col h-full py-6 px-6 space-y-6 animate-in fade-in duration-500">
    <div class="flex flex-col md:flex-row md:items-end justify-between border-b border-gray-200 dark:border-[#1E1E1E] pb-6 gap-4">
        <div>
            <h2 class="text-xl font-mono font-bold text-black dark:text-white uppercase tracking-wider">> System Configuration</h2>
            <p class="text-[10px] text-gray-500 font-mono mt-1 uppercase">User Preferences & Account Security</p>
        </div>
        <div class="flex items-center gap-3">
            <div class="px-4 py-2 bg-gray-100 dark:bg-[#0A0A0A] border border-gray-200 dark:border-[#1E1E1E] text-center min-w-[120px]">
                <p class="text-[8px] font-bold text-gray-500 uppercase tracking-widest">Account Status</p>
                <p class="text-[10px] font-mono font-bold text-green-600 dark:text-green-500 uppercase">ACTIVE</p>
            </div>
        </div>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <div class="bg-white dark:bg-[#0A0A0A] border border-gray-200 dark:border-[#1E1E1E] p-6 shadow-glow relative group">
            <div class="absolute top-0 right-0 p-3 opacity-5 text-6xl font-black text-black dark:text-white rotate-12 -mt-3 -mr-3 transition-transform group-hover:scale-110">ID</div>
            <h3 class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-6">Profile Identity</h3>
            <div class="space-y-5">
                <div class="space-y-1">
                    <label class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">Username</label>
                    <input type="text" value="{{ user.username }}" disabled class="w-full p-3 bg-gray-50 dark:bg-[#050505] border border-gray-200 dark:border-[#1E1E1E] text-[10px] font-mono text-black dark:text-white cursor-not-allowed opacity-70">
                </div>
                <div class="space-y-1">
                    <label class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">Email Address</label>
                    <input type="text" value="{{ user.email }}" disabled class="w-full p-3 bg-gray-50 dark:bg-[#050505] border border-gray-200 dark:border-[#1E1E1E] text-[10px] font-mono text-black dark:text-white cursor-not-allowed opacity-70">
                </div>
                <div class="pt-2">
                    <button onclick="requestPasswordReset()" class="w-full py-3 border border-red-500/20 text-red-500 hover:bg-red-500 hover:text-white text-[10px] font-mono font-bold uppercase tracking-widest transition-all">
                        Reset Password
                    </button>
                </div>
            </div>
        </div>

        <div class="bg-white dark:bg-[#0A0A0A] border border-gray-200 dark:border-[#1E1E1E] p-6 shadow-glow relative group">
            <div class="absolute top-0 right-0 p-3 opacity-5 text-6xl font-black text-blue-500 rotate-12 -mt-3 -mr-3 transition-transform group-hover:scale-110">CFG</div>
            <h3 class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-6">Default Config</h3>
            <div class="space-y-5">
                <div class="space-y-1">
                    <label class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">Default Service</label>
                    <select id="def_label_type" class="w-full p-3 bg-gray-50 dark:bg-[#050505] border border-gray-200 dark:border-[#1E1E1E] text-[10px] font-mono text-black dark:text-white uppercase outline-none focus:border-black dark:focus:border-white transition-all cursor-pointer">
                        <option value="priority" {% if user.default_label_type == 'priority' %}selected{% endif %}>Priority V2</option>
                    </select>
                </div>
                <div class="space-y-1">
                    <label class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">Default Version</label>
                    <select id="def_version" class="w-full p-3 bg-gray-50 dark:bg-[#050505] border border-gray-200 dark:border-[#1E1E1E] text-[10px] font-mono text-black dark:text-white uppercase outline-none focus:border-black dark:focus:border-white transition-all cursor-pointer">
                        <option value="95055" {% if user.default_version == '95055' %}selected{% endif %}>95055 (Standard)</option>
                        <option value="94888" {% if user.default_version == '94888' %}selected{% endif %}>94888 (Legacy)</option>
                        <option value="94019" {% if user.default_version == '94019' %}selected{% endif %}>94019 (Test)</option>
                    </select>
                </div>
                <div class="space-y-1">
                    <label class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">Default Template</label>
                    <select id="def_template" class="w-full p-3 bg-gray-50 dark:bg-[#050505] border border-gray-200 dark:border-[#1E1E1E] text-[10px] font-mono text-black dark:text-white uppercase outline-none focus:border-black dark:focus:border-white transition-all cursor-pointer">
                        <option value="pitney_v2" {% if user.default_template == 'pitney_v2' %}selected{% endif %}>Pitney Bowes [V2]</option>
                        <option value="stamps_v2" {% if user.default_template == 'stamps_v2' %}selected{% endif %}>Stamps.com [V2]</option>
                        <option value="easypost_v2" {% if user.default_template == 'easypost_v2' %}selected{% endif %}>EasyPost [V2]</option>
                    </select>
                </div>
                <div class="pt-2">
                    <button onclick="saveDefaults()" id="saveDefBtn" class="w-full py-3 bg-black dark:bg-white text-white dark:text-black hover:opacity-90 text-[10px] font-mono font-bold uppercase tracking-widest transition-all shadow-sm">
                        Save Defaults
                    </button>
                </div>
            </div>
        </div>

        <div class="bg-white dark:bg-[#0A0A0A] border border-gray-200 dark:border-[#1E1E1E] p-6 shadow-glow relative group">
            <div class="absolute top-0 right-0 p-3 opacity-5 text-6xl font-black text-green-500 rotate-12 -mt-3 -mr-3 transition-transform group-hover:scale-110">$</div>
            <h3 class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-6">Service Pricing</h3>
            <div class="space-y-3">
                
                <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-[#050505] border border-gray-200 dark:border-[#1E1E1E]">
                    <span class="text-[10px] font-bold text-gray-700 dark:text-gray-300 uppercase">95055 (V2)</span>
                    <span id="price_95055" class="text-[10px] font-mono font-bold text-green-600 dark:text-green-500">Loading...</span>
                </div>

                <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-[#050505] border border-gray-200 dark:border-[#1E1E1E]">
                    <span class="text-[10px] font-bold text-gray-700 dark:text-gray-300 uppercase">94888 (V1)</span>
                    <span id="price_94888" class="text-[10px] font-mono font-bold text-green-600 dark:text-green-500">Loading...</span>
                </div>

                <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-[#050505] border border-gray-200 dark:border-[#1E1E1E]">
                    <span class="text-[10px] font-bold text-gray-700 dark:text-gray-300 uppercase">94019 (Test)</span>
                    <span id="price_94019" class="text-[10px] font-mono font-bold text-green-600 dark:text-green-500">Loading...</span>
                </div>

            </div>
            <div class="mt-8 p-4 border border-blue-500/20 bg-blue-500/5">
                <p class="text-[9px] font-bold text-blue-500 uppercase leading-relaxed font-mono">
                    > NOTE: Pricing is dynamic based on volume. Contact support for bulk discounts > 1k/day.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    function requestPasswordReset() {
        showNotification("CONTACT ADMIN TO RESET PASSWORD", "error");
    }

    async function saveDefaults() {
        const btn = document.getElementById('saveDefBtn');
        const orig = btn.innerText;
        btn.innerText = "SAVING...";
        
        try {
            const res = await fetch('/api/settings/defaults', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    label_type: document.getElementById('def_label_type').value,
                    version: document.getElementById('def_version').value,
                    template: document.getElementById('def_template').value
                })
            });
            if(res.ok) {
                showNotification("DEFAULT PREFERENCES SAVED", "success");
            } else {
                showNotification("FAILED TO SAVE SETTINGS", "error");
            }
        } catch(e) {
            showNotification("CONNECTION ERROR", "error");
        }
        btn.innerText = orig;
    }

    // --- FETCH & DISPLAY MULTI PRICING ---
    async function loadPrices() {
        try {
            const res = await fetch('/api/user');
            const data = await res.json();
            
            // Helper to set price text
            const setP = (id, val) => {
                const el = document.getElementById(id);
                if(el) el.innerText = '$' + parseFloat(val).toFixed(2);
            };
            
            if (data.prices) {
                setP('price_95055', data.prices['95055']);
                setP('price_94888', data.prices['94888']);
                setP('price_94019', data.prices['94019']);
            } else {
                // Fallback for old accounts
                const base = parseFloat(data.price_per_label).toFixed(2);
                setP('price_95055', base);
                setP('price_94888', base);
                setP('price_94019', base);
            }
        } catch(e) {}
    }
    loadPrices();
</script>